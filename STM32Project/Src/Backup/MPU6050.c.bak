#include "MPU6050.h"
#include "i2c.h"
#include <stdlib.h>


void readData(MPU6050* mpu) {
	static uint8_t buff[6];

	memset(buff, 0, 6);
	i2c_read_n(MPU6050_ADDRESS, MPU_6050_REG_ACCEL_XOUT_H, buff, 6);

	for(int i = 1, j = 0; i < 6; i += 2, ++j) {
		int16_t a = buff[i], b = buff[i+1];
		mpu->acc[j] = 1.0*((a << 8) | b )/ 16384.0;
	}

}
void MPU6050init(MPU6050* mpu) {

	/* TODO:
	 * Initialize the MPU, set up the sampling rate
	 */
	//turn off hpf and lpf (gain=1)
	mpu->hpf.lastU = mpu->hpf.lastY = mpu->hpf.a1 = mpu->hpf.b0 = mpu->hpf.b1 = 0;

	mpu->hpf.b1 = 1;

	mpu->lpf.a1 = mpu->lpf.b1 = mpu->lpf.lastU = mpu->lpf.lastY = 0;
	mpu->lpf.b1 = 1;

	i2c_write(MPU6050_ADDRESS, MPU_6050_REG_PWR_MGMT_1, 0x00);	//reset MPU
}
